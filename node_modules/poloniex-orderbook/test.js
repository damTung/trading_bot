const debug = require('debug')('polobook:ws');
const WebSocket = require('ws');
const utils = require('util');
const inspect = function (obj) {
  return utils.inspect(obj, { depth: 5, color: true });
};

const ws = new WebSocket('wss://api2.poloniex.com', [], {
  headers: {
    'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.86 Safari/537.36',
    //'Cookie': 'cf_clearance=7fc5813601c33337aae98be84fe411b4e45452f9-1501826118-1800;'
    'Cookie': 'cf_clearance=108e7b85cba0fd321daef8d06fad7868110441a2-1501655007-1800;'
  }
});

//{
//  headers: {
//    Cookie: '__cfduid=d02da96b9f412e8058b5e6f8150e12a3c1501654988; cf_clearance=108e7b85cba0fd321daef8d06fad7868110441a2-1501655007-1800; _gat=1; _ga=GA1.2.1776811287.1501655008; _gid=GA1.2.998692077.1501655008; POLOSESSID=o4277rfrgb2oki5vrble4ij9b4'
//  }
//}

ws.on('open', function open(ws, req) {
  console.log('open', ws, req);
});

ws.on('connection', function connection(ws, req) {
  console.log('connection', arguments);
});

ws.on('response', function connection(ws, req) {
  console.log('response', arguments);
});

ws.on('data', function connection(ws, req) {
  console.log('data', arguments);
});

ws.on('message', function connection(ws, req) {
  console.log('message', arguments, this);
});

ws.on('error', function error(err) {

  console.log(err);

});

ws.on('unexpected-response', function (req, res) {
  //const key = Object.getOwnPropertySymbols(req)[0];
  //console.log(inspect(req[key]));
  let chunks = '';

  console.log(res.headers);
  //process.exit();

  res.on('data', function(data){
    chunks += data;
  });

  res.on('end', function () {
    //console.log(chunks);
  })

  //console.log(req[k], res[k], res);
});